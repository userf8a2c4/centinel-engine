# Configuración de reintentos y resiliencia para descargas C.E.N.T.I.N.E.L.
# Retry & resilience configuration for downloads.

default:
  max_attempts: 5
  backoff_base: 2
  backoff_multiplier: 2
  max_delay: 300
  jitter: 0.25

# Reglas específicas por status HTTP.
per_status:
  "429":
    max_attempts: 20
    backoff_base: 8
    backoff_multiplier: 2
    max_delay: 900
    jitter:
      min: 0.1
      max: 0.3
  "5xx":
    max_attempts: 8
    backoff_base: 3
    backoff_multiplier: 2
    max_delay: 300
    jitter: 0.2
  "403":
    max_attempts: 2
    action: "alert_only"
  "401":
    max_attempts: 2
    action: "alert_only"
  "400":
    max_attempts: 3
    action: "alert_only"
  "404":
    max_attempts: 2
    backoff_base: 2
    max_delay: 60
    jitter: 0.2

# Otros códigos no listados arriba.
other_status:
  max_attempts: 3
  backoff_base: 2
  max_delay: 120
  jitter: 0.2

# Reglas específicas por excepción.
per_exception:
  ConnectionError:
    max_attempts: 6
    backoff_base: 2
    backoff_multiplier: 2
    max_delay: 120
    jitter: 0.2
  ReadTimeout:
    max_attempts: 6
    backoff_base: 2
    backoff_multiplier: 2
    max_delay: 120
    jitter: 0.2
  SSLError:
    max_attempts: 5
    backoff_base: 2
    backoff_multiplier: 2
    max_delay: 120
    jitter: 0.2
  JSONDecodeError:
    max_attempts: 3
    backoff_base: 2
    backoff_multiplier: 2
    max_delay: 60
    jitter: 0.15

# Timeout por request (segundos).
timeout_seconds: 30

# Archivo donde se registran fallos definitivos.
failed_requests_path: failed_requests.jsonl

# Idempotencia: evita descargas duplicadas si existe snapshot reciente.
recent_snapshot_seconds: 300
idempotency_mode: "timestamp"

# Tamaño máximo del payload en logs para errores de parsing.
log_payload_bytes: 2000
